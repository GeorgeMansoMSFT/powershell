{
   "createSingleDCR":{
      "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
      "contentVersion":"1.0.0.0",
      "parameters":{
         "defaultctDataCollectionRuleName":{
            "type":"string",
            "metadata":{
               "description":"Specifies the name of the data collection rule to create."
            },
            "defaultValue":"Microsoft-CT"
         },
         "destinationWorkspaceResourceId":{
            "type":"string",
            "metadata":{
               "description":"Specifies the Azure resource ID of the Log Analytics workspace to use to store change tracking data."
            }
         },
         "dataCollectionRuleLocation":{
            "type":"string",
            "metadata":{
               "description":"The location code in which the data collection rule should be deployed. Examples: eastus, westeurope, etc"
            }
         },
         "destinationWorkspaceSubscription":{
            "type":"string",
            "metadata":{
               "description":"Subscription of the log analytics workspace"
            }
         },
         "destinationWorkspaceResourceGroup":{
            "type":"string",
            "metadata":{
               "description":"Resource group of the log analytics workspace"
            }
         },
         "destinationWorkspaceName":{
            "type":"string",
            "metadata":{
               "description":"Name of the log analytics workspace"
            }
         }
      },
      "resources":[
         {
            "type":"Microsoft.OperationsManagement/solutions",
            "name":"[Concat('ChangeTracking', '(', parameters('destinationWorkspaceName'), ')')]",
            "location":"[parameters('dataCollectionRuleLocation')]",
            "apiVersion":"2015-11-01-preview",
            "id":"[Concat('/subscriptions/', parameters('destinationWorkspaceSubscription'), '/resourceGroups/', parameters('destinationWorkspaceResourceGroup'), '/providers/Microsoft.OperationsManagement/solutions/ChangeTracking', '(', parameters('destinationWorkspaceName'), ')')]",
            "properties":{
               "workspaceResourceId":"[parameters('destinationWorkspaceResourceId')]"
            },
            "plan":{
               "name":"[Concat('ChangeTracking', '(', parameters('destinationWorkspaceName'), ')')]",
               "product":"OMSGallery/ChangeTracking",
               "promotionCode":"",
               "publisher":"Microsoft"
            }
         },
         {
            "type":"Microsoft.Insights/dataCollectionRules",
            "name":"[parameters('defaultctDataCollectionRuleName')]",
            "location":"[parameters('dataCollectionRuleLocation')]",
            "apiVersion":"2019-11-01-preview",
            "properties":{
               "description":"Data collection rule for ct.",
               "dataSources":{
                  "extensions":[
                     {
                        "streams":[
                           "Microsoft-ConfigurationChange",
                           "Microsoft-ConfigurationChangeV2",
                           "Microsoft-ConfigurationData"
                        ],
                        "extensionName":"ChangeTracking-Windows",
                        "extensionSettings":{
                           "enableFiles":true,
                           "enableSoftware":true,
                           "enableRegistry":true,
                           "enableServices":true,
                           "enableInventory":true,
                           "registrySettings":{
                              "registryCollectionFrequency":3000,
                              "registryInfo":[
                                 {
                                    "name":"Registry_1",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_2",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Shutdown",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_3",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_4",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_5",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\ShellEx\\ContextMenuHandlers",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_6",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Background\\ShellEx\\ContextMenuHandlers",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_7",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Shellex\\CopyHookHandlers",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_8",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_9",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_10",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Browser Helper Objects",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_11",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Browser Helper Objects",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_12",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Internet Explorer\\Extensions",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_13",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Internet Explorer\\Extensions",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_14",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Drivers32",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_15",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Drivers32",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_16",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\KnownDlls",
                                    "valueName":""
                                 },
                                 {
                                    "name":"Registry_17",
                                    "groupTag":"Recommended",
                                    "enabled":false,
                                    "recurse":true,
                                    "description":"",
                                    "keyName":"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify",
                                    "valueName":""
                                 }
                              ]
                           },
                           "fileSettings":{
                              "fileCollectionFrequency":2700
                           },
                           "softwareSettings":{
                              "softwareCollectionFrequency":1800
                           },
                           "inventorySettings":{
                              "inventoryCollectionFrequency":36000
                           },
                           "servicesSettings":{
                              "serviceCollectionFrequency":1800
                           }
                        },
                        "name":"CTDataSource-Windows"
                     },
                     {
                        "streams":[
                           "Microsoft-ConfigurationChange",
                           "Microsoft-ConfigurationChangeV2",
                           "Microsoft-ConfigurationData"
                        ],
                        "extensionName":"ChangeTracking-Linux",
                        "extensionSettings":{
                           "enableFiles":true,
                           "enableSoftware":true,
                           "enableRegistry":false,
                           "enableServices":true,
                           "enableInventory":true,
                           "fileSettings":{
                              "fileCollectionFrequency":900,
                              "fileInfo":[
                                 {
                                    "name":"ChangeTrackingLinuxPath_default",
                                    "enabled":true,
                                    "destinationPath":"/etc/.*.conf",
                                    "useSudo":true,
                                    "recurse":true,
                                    "maxContentsReturnable":5000000,
                                    "pathType":"File",
                                    "type":"File",
                                    "links":"Follow",
                                    "maxOutputSize":500000,
                                    "groupTag":"Recommended"
                                 }
                              ]
                           },
                           "softwareSettings":{
                              "softwareCollectionFrequency":300
                           },
                           "inventorySettings":{
                              "inventoryCollectionFrequency":36000
                           },
                           "servicesSettings":{
                              "serviceCollectionFrequency":300
                           }
                        },
                        "name":"CTDataSource-Linux"
                     }
                  ]
               },
               "destinations":{
                  "logAnalytics":[
                     {
                        "workspaceResourceId":"[parameters('destinationWorkspaceResourceId')]",
                        "name":"Microsoft-CT-Dest"
                     }
                  ]
               },
               "dataFlows":[
                  {
                     "streams":[
                        "Microsoft-ConfigurationChange",
                        "Microsoft-ConfigurationChangeV2",
                        "Microsoft-ConfigurationData"
                     ],
                     "destinations":[
                        "Microsoft-CT-Dest"
                     ]
                  }
               ]
            }
         }
      ]
   },
   "createDCRs":{
      "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
      "contentVersion":"1.0.0.0",
      "parameters":{
         "dcrs":{
            "type":"array",
            "defaultValue":[
               {
                  "exists":false,
                  "dcrId":"",
                  "dcrName":"",
                  "linkedWorkspaceResourceId":"",
                  "location":"",
                  "linkedWorkspaceResourceGroup":"",
                  "linkedWorkspaceSubscription":"",
                  "linkedWorkspaceName":""
               }
            ]
         },
         "createDcrTemplate":{
            "type":"object",
            "defaultValue":{
               
            }
         }
      },
      "resources":[
         {
            "type":"Microsoft.Resources/deployments",
            "name":"[concat(deployment().name, '.set', copyIndex(), '.deployment')]",
            "apiVersion":"2017-05-10",
            "subscriptionId":"[parameters('dcrs')[copyIndex()].linkedWorkspaceSubscription]",
            "resourceGroup":"[parameters('dcrs')[copyIndex()].linkedWorkspaceResourceGroup]",
            "comments":"Creates dcrs",
            "properties":{
               "mode":"Incremental",
               "template":"[parameters('createDcrTemplate')]",
               "parameters":{
                  "defaultctDataCollectionRuleName":{
                     "value":"[parameters('dcrs')[copyIndex()].dcrName]"
                  },
                  "destinationWorkspaceResourceId":{
                     "value":"[parameters('dcrs')[copyIndex()].linkedWorkspaceResourceId]"
                  },
                  "dataCollectionRuleLocation":{
                     "value":"[parameters('dcrs')[copyIndex()].location]"
                  },
                  "destinationWorkspaceSubscription":{
                     "value":"[parameters('dcrs')[copyIndex()].linkedWorkspaceSubscription]"
                  },
                  "destinationWorkspaceResourceGroup":{
                     "value":"[parameters('dcrs')[copyIndex()].linkedWorkspaceResourceGroup]"
                  },
                  "destinationWorkspaceName":{
                     "value":"[parameters('dcrs')[copyIndex()].linkedWorkspaceName]"
                  }
               }
            },
            "copy":{
               "name":"dcrCopy",
               "count":"[length(parameters('dcrs'))]"
            }
         }
      ],
      "outputs":{
         "dcrArr":{
            "value":"[parameters('dcrs')]",
            "type":"array"
         }
      }
   },
   "installSingleCTExtension":{
      "$schema":"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
      "contentVersion":"1.0.0.0",
      "parameters":{
         "virtualMachineName":{
            "type":"string",
            "metadata":{
               "description":"Specifies the name of the virtual machine."
            }
         },
         "virtualMachineRP":{
            "type":"string",
            "metadata":{
               "description":"Specifies the resource provider of the virtual machine."
            }
         },
         "virtualMachineLocation":{
            "type":"string",
            "metadata":{
               "description":"The location code of the virtual machine region (location). Examples: eastus, westeurope, etc"
            }
         },
         "virtualMachineOsType":{
            "type":"string",
            "metadata":{
               "description":"Specifies operating system type of the target virtual machine."
            },
            "allowedValues":[
               "windows",
               "linux"
            ]
         },
         "dataCollectionRuleAssociationName":{
            "type":"string",
            "metadata":{
               "description":"Specifies the name of the data collection rule association to create."
            },
            "defaultValue":"VM-Ct-Dcr-Association"
         },
         "ctDataCollectionRuleResourceId":{
            "type":"string",
            "metadata":{
               "description":"Specifies resource id of Azure Monitor Data Collection Rule for ct."
            }
         },
         "installAma":{
            "type":"bool",
            "metadata":{
               "description":"Azure Monitoring Agent is installed or not."
            }
         },
         "enableIdentity":{
            "type":"bool",
            "metadata":{
               "description":"Enable system assigned managed identity on the virtual machine if required"
            }
         }
      },
      "variables":{
         "ctExtensionProperties":{
            "windows":{
               "publisher":"Microsoft.Azure.ChangeTrackingAndInventory",
               "type":"ChangeTracking-Windows",
               "typeHandlerVersion":"2.0",
               "autoUpgradeMinorVersion":true,
               "enableAutomaticUpgrade":false
            },
            "arc-windows":{
               "publisher":"Microsoft.Azure.ChangeTrackingAndInventory",
               "type":"ChangeTracking-Windows",
               "autoUpgradeMinorVersion":true,
               "enableAutomaticUpgrade":false
            },
            "linux":{
               "publisher":"Microsoft.Azure.ChangeTrackingAndInventory",
               "type":"ChangeTracking-Linux",
               "typeHandlerVersion":"2.0",
               "autoUpgradeMinorVersion":true,
               "enableAutomaticUpgrade":false
            },
            "arc-linux":{
               "publisher":"Microsoft.Azure.ChangeTrackingAndInventory",
               "type":"ChangeTracking-Linux",
               "autoUpgradeMinorVersion":true,
               "enableAutomaticUpgrade":false
            }
         },
         "azureMonitorAgentExtensionProperties":{
            "windows":{
               "publisher":"Microsoft.Azure.Monitor",
               "type":"AzureMonitorWindowsAgent",
               "typeHandlerVersion":"1.0",
               "autoUpgradeMinorVersion":true
            },
            "arc-windows":{
               "publisher":"Microsoft.Azure.Monitor",
               "type":"AzureMonitorWindowsAgent",
               "autoUpgradeMinorVersion":true
            },
            "linux":{
               "publisher":"Microsoft.Azure.Monitor",
               "type":"AzureMonitorLinuxAgent",
               "typeHandlerVersion":"1.0",
               "autoUpgradeMinorVersion":true
            },
            "arc-linux":{
               "publisher":"Microsoft.Azure.Monitor",
               "type":"AzureMonitorLinuxAgent",
               "autoUpgradeMinorVersion":true
            }
         }
      },
      "resources":[
         {
            "condition":"[and(parameters('enableIdentity'),equals(parameters('virtualMachineRP'), 'Microsoft.HybridCompute/machines'))]",
            "type":"Microsoft.HybridCompute/machines",
            "name":"[parameters('virtualMachineName')]",
            "location":"[parameters('virtualMachineLocation')]",
            "apiVersion":"2019-03-18-preview",
            "identity":{
               "type":"SystemAssigned"
            }
         },
         {
            "condition":"[and(parameters('enableIdentity'),equals(parameters('virtualMachineRP'), 'Microsoft.Compute/virtualMachines'))]",
            "type":"Microsoft.Compute/virtualMachines",
            "name":"[parameters('virtualMachineName')]",
            "location":"[parameters('virtualMachineLocation')]",
            "apiVersion":"2017-03-30",
            "identity":{
               "type":"SystemAssigned"
            }
         },
         {
            "condition":"[equals(parameters('virtualMachineRP'), 'Microsoft.HybridCompute/machines')]",
            "type":"Microsoft.HybridCompute/machines/providers/dataCollectionRuleAssociations",
            "name":"[concat(parameters('virtualMachineName'), '/Microsoft.Insights/', parameters('dataCollectionRuleAssociationName'))]",
            "apiVersion":"2021-04-01",
            "properties":{
               "description":"Association of data collection rule for CT",
               "dataCollectionRuleId":"[parameters('ctDataCollectionRuleResourceId')]"
            }
         },
         {
            "condition":"[equals(parameters('virtualMachineRP'), 'Microsoft.Compute/virtualMachines')]",
            "type":"Microsoft.Compute/virtualMachines/providers/dataCollectionRuleAssociations",
            "name":"[concat(parameters('virtualMachineName'), '/Microsoft.Insights/', parameters('dataCollectionRuleAssociationName'))]",
            "apiVersion":"2019-11-01-preview",
            "properties":{
               "description":"Association of data collection rule for CT",
               "dataCollectionRuleId":"[parameters('ctDataCollectionRuleResourceId')]"
            }
         },
         {
            "condition":"[and(parameters('installAma'),equals(parameters('virtualMachineRP'), 'Microsoft.HybridCompute/machines'))]",
            "type":"Microsoft.HybridCompute/machines/extensions",
            "apiVersion":"2021-05-20",
            "name":"[concat(parameters('virtualMachineName'), '/', variables('azureMonitorAgentExtensionProperties')[parameters('virtualMachineOsType')].type)]",
            "location":"[parameters('virtualMachineLocation')]",
            "dependsOn":[
               "[resourceId(concat(parameters('virtualMachineRP'),'/providers/dataCollectionRuleAssociations'), parameters('virtualMachineName'), 'Microsoft.Insights', parameters('dataCollectionRuleAssociationName'))]"
            ],
            "properties":"[variables('azureMonitorAgentExtensionProperties')[concat('arc-',parameters('virtualMachineOsType'))]]"
         },
         {
            "condition":"[and(parameters('installAma'),equals(parameters('virtualMachineRP'), 'Microsoft.Compute/virtualMachines'))]",
            "type":"Microsoft.Compute/virtualMachines/extensions",
            "apiVersion":"2019-12-01",
            "name":"[concat(parameters('virtualMachineName'), '/', variables('azureMonitorAgentExtensionProperties')[parameters('virtualMachineOsType')].type)]",
            "location":"[parameters('virtualMachineLocation')]",
            "dependsOn":[
               "[resourceId(concat(parameters('virtualMachineRP'),'/providers/dataCollectionRuleAssociations'), parameters('virtualMachineName'), 'Microsoft.Insights', parameters('dataCollectionRuleAssociationName'))]"
            ],
            "properties":"[variables('azureMonitorAgentExtensionProperties')[parameters('virtualMachineOsType')]]"
         },
         {
            "condition":"[equals(parameters('virtualMachineRP'), 'Microsoft.HybridCompute/machines')]",
            "type":"Microsoft.HybridCompute/machines/extensions",
            "name":"[concat(parameters('virtualMachineName'), '/', variables('ctExtensionProperties')[parameters('virtualMachineOsType')].type)]",
            "location":"[parameters('virtualMachineLocation')]",
            "apiVersion":"2021-06-10-preview",
            "dependsOn":[
               "[resourceId(concat(parameters('virtualMachineRP'),'/providers/dataCollectionRuleAssociations'), parameters('virtualMachineName'), 'Microsoft.Insights', parameters('dataCollectionRuleAssociationName'))]"
            ],
            "properties":"[variables('ctExtensionProperties')[concat('arc-',parameters('virtualMachineOsType'))]]"
         },
         {
            "condition":"[equals(parameters('virtualMachineRP'), 'Microsoft.Compute/virtualMachines')]",
            "type":"Microsoft.Compute/virtualMachines/extensions",
            "name":"[concat(parameters('virtualMachineName'), '/', variables('ctExtensionProperties')[parameters('virtualMachineOsType')].type)]",
            "location":"[parameters('virtualMachineLocation')]",
            "apiVersion":"2018-06-01",
            "dependsOn":[
               "[resourceId(concat(parameters('virtualMachineRP'),'/providers/dataCollectionRuleAssociations'), parameters('virtualMachineName'), 'Microsoft.Insights', parameters('dataCollectionRuleAssociationName'))]"
            ],
            "properties":"[variables('ctExtensionProperties')[parameters('virtualMachineOsType')]]"
         }
      ]
   },
   "installCTExtensions":{
      "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
      "contentVersion":"1.0.0.0",
      "parameters":{
         "machines":{
            "type":"array",
            "defaultValue":[
               {
                  "locationId":"",
                  "resourceId":"",
                  "workspaceId":"",
                  "identityRequired":false,
                  "osType":{
                     "type":"string",
                     "allowedValues":[
                        "Windows",
                        "Linux"
                     ]
                  },
                  "virtualMachineName":"",
                  "dcrAssociation":{
                     "type":"object",
                     "defaultValue":{
                        "exists":false,
                        "dcrId":"",
                        "linkedWorkspaceResourceId":"",
                        "location":""
                     }
                  },
                  "installAma":"",
                  "enableIdentity":""
               }
            ]
         },
         "installSingleCtExtensionTemplate":{
            "type":"object",
            "defaultValue":{
               
            }
         }
      },
      "resources":[
         {
            "type":"Microsoft.Resources/deployments",
            "name":"[concat(deployment().name, '.set', copyIndex(), '.deployment')]",
            "apiVersion":"2017-05-10",
            "subscriptionId":"[subscription().subscriptionId]",
            "resourceGroup":"[resourceGroup().name]",
            "comments":"Install CTs",
            "properties":{
               "mode":"Incremental",
               "template":"[parameters('installSingleCtExtensionTemplate')]",
               "parameters":{
                  "virtualMachineName":{
                     "value":"[parameters('machines')[copyIndex()].virtualMachineName]"
                  },
                  "virtualMachineRP":{
                     "value":"[parameters('machines')[copyIndex()].virtualMachineRP]"
                  },
                  "virtualMachineLocation":{
                     "value":"[parameters('machines')[copyIndex()].locationId]"
                  },
                  "virtualMachineOsType":{
                     "value":"[parameters('machines')[copyIndex()].osType]"
                  },
                  "dataCollectionRuleAssociationName":{
                     "value":"[concat('dcra-default', copyIndex())]"
                  },
                  "ctDataCollectionRuleResourceId":{
                     "value":"[parameters('machines')[copyIndex()].dcrAssociation.dcrId]"
                  },
                  "installAma":{
                     "value":"[parameters('machines')[copyIndex()].installAma]"
                  },
                  "enableIdentity":{
                     "value":"[parameters('machines')[copyIndex()].enableIdentity]"
                  }
               }
            },
            "copy":{
               "name":"ctExtensionCopy",
               "count":"[length(parameters('machines'))]"
            }
         }
      ]
   }
}
